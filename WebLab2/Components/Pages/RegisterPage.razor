@page "/register"
@using WebLab2.Models
@inject HttpClient Http
@inject NavigationManager Navigation

<PageTitle>Register</PageTitle>

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <p style="color: red">@ErrorMessage</p>
}

<EditForm Model="registerModel" OnValidSubmit="RegisterUser">
    <DataAnnotationsValidator />
    <div style="display: flex; flex-direction: column; gap: 1rem; max-width: 400px;">
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Username:</label>
            <InputText @bind-Value="registerModel.Username" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">First Name:</label>
            <InputText @bind-Value="registerModel.FirstName" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Last Name:</label>
            <InputText @bind-Value="registerModel.LastName" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Email:</label>
            <InputText @bind-Value="registerModel.Email" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Phone Number:</label>
            <InputText @bind-Value="registerModel.PhoneNumber" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Country:</label>
            <InputText @bind-Value="registerModel.Country" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">City:</label>
            <InputText @bind-Value="registerModel.City" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Address:</label>
            <InputText @bind-Value="registerModel.Address" style="flex: 1;" />
        </div>
        <div style="display: flex; align-items: center;">
            <label style="width: 120px;">Password:</label>
            <InputText @bind-Value="registerModel.Password" type="password" style="flex: 1;" />
        </div>
        <button type="submit" style="margin-top: 1rem;">Register</button>
    </div>
</EditForm>

@code {
    private UserDto registerModel = new();
    private string ErrorMessage = "";

    private async Task RegisterUser()
    {
        ErrorMessage = "";

        var response = await Http.PostAsJsonAsync($"{Navigation.BaseUri}api/auth/register", registerModel);

        if (response.IsSuccessStatusCode)
        {
            ErrorMessage = "Registration successful! Redirecting to login...";
            await Task.Delay(2000);
            Navigation.NavigateTo("/login");
        }
        else
        {
            ErrorMessage = await response.Content.ReadAsStringAsync();
        }
    }
}